"use strict";(globalThis.webpackChunkdocs_worklets=globalThis.webpackChunkdocs_worklets||[]).push([[6604],{30620:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>s});var a=n(39471);const l={},i=a.createContext(l);function r(e){const t=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),a.createElement(i.Provider,{value:t},e.children)}},69192:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"guides/feature-flags","title":"Feature flags","description":"Feature flags allow developers to opt-in for experimental changes or opt-out from recent changes that have already been made default. Feature flags serve as a tool for incremental rollout of new implementation without affecting the general stability of the library, allowing to gather feedback from early adopters. There are two types of feature flags: static and dynamic.","source":"@site/docs/guides/feature-flags.md","sourceDirName":"guides","slug":"/guides/feature-flags","permalink":"/react-native-worklets/docs/guides/feature-flags","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-reanimated/edit/main/docs/docs-worklets/docs/guides/feature-flags.md","tags":[],"version":"current","frontMatter":{"id":"feature-flags","title":"Feature flags","sidebar_label":"Feature flags"},"sidebar":"tutorialSidebar","previous":{"title":"Compatibility","permalink":"/react-native-worklets/docs/guides/compatibility"},"next":{"title":"Testing with Jest","permalink":"/react-native-worklets/docs/guides/testing"}}');var l=n(47671),i=n(30620);const r={id:"feature-flags",title:"Feature flags",sidebar_label:"Feature flags"},s=void 0,d={},o=[{value:"Summary of available feature flags",id:"summary-of-available-feature-flags",level:2},{value:"Description of available feature flags",id:"description-of-available-feature-flags",level:2},{value:"<code>BUNDLE_MODE_ENABLED</code> <AvailableFrom></AvailableFrom>",id:"bundle_mode_enabled-",level:3},{value:"<code>FETCH_PREVIEW_ENABLED</code> <AvailableFrom></AvailableFrom>",id:"fetch_preview_enabled-",level:3},{value:"<code>IOS_DYNAMIC_FRAMERATE_ENABLED</code> <AvailableFrom></AvailableFrom>",id:"ios_dynamic_framerate_enabled-",level:3},{value:"Static feature flags",id:"static-feature-flags",level:2},{value:"Dynamic feature flags",id:"dynamic-feature-flags",level:2},{value:"Comparison of static and dynamic feature flags",id:"comparison-of-static-and-dynamic-feature-flags",level:2},{value:"Remarks for contributors",id:"remarks-for-contributors",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components},{AvailableFrom:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("AvailableFrom",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(t.p,{children:"Feature flags allow developers to opt-in for experimental changes or opt-out from recent changes that have already been made default. Feature flags serve as a tool for incremental rollout of new implementation without affecting the general stability of the library, allowing to gather feedback from early adopters. There are two types of feature flags: static and dynamic."}),"\n",(0,l.jsx)(t.h2,{id:"summary-of-available-feature-flags",children:"Summary of available feature flags"}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{children:"Feature flag name"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"Type"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"Added in"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"Removed in"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"Default value"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{children:(0,l.jsx)(t.a,{href:"#bundle_mode_enabled-",children:(0,l.jsx)(t.code,{children:"BUNDLE_MODE_ENABLED"})})}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:(0,l.jsx)(t.a,{href:"#static-feature-flags",children:"static"})}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"0.8.0"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u2013"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:(0,l.jsx)(t.code,{children:"false"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{children:(0,l.jsx)(t.a,{href:"#fetch_preview_enabled-",children:(0,l.jsx)(t.code,{children:"FETCH_PREVIEW_ENABLED"})})}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:(0,l.jsx)(t.a,{href:"#static-feature-flags",children:"static"})}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"0.8.0"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u2013"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:(0,l.jsx)(t.code,{children:"false"})})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{children:(0,l.jsx)(t.a,{href:"#ios_dynamic_framerate_enabled-",children:(0,l.jsx)(t.code,{children:"IOS_DYNAMIC_FRAMERATE_ENABLED"})})}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:(0,l.jsx)(t.a,{href:"#static-feature-flags",children:"static"})}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"0.6.0"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u2013"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:(0,l.jsx)(t.code,{children:"true"})})]})]})]}),"\n",(0,l.jsx)(t.admonition,{type:"info",children:(0,l.jsxs)(t.p,{children:["Feature flags available in ",(0,l.jsx)(t.code,{children:"react-native-reanimated"})," are listed ",(0,l.jsx)(t.a,{href:"https://docs.swmansion.com/react-native-reanimated/docs/guides/feature-flags",children:"on this page"}),"."]})}),"\n",(0,l.jsx)(t.h2,{id:"description-of-available-feature-flags",children:"Description of available feature flags"}),"\n",(0,l.jsxs)(t.h3,{id:"bundle_mode_enabled-",children:[(0,l.jsx)(t.code,{children:"BUNDLE_MODE_ENABLED"})," ",(0,l.jsx)(n,{version:"0.8.0"})]}),"\n",(0,l.jsxs)(t.p,{children:["This feature flag enables ",(0,l.jsx)(t.a,{href:"/docs/bundleMode/",children:"the Bundle Mode"}),". Make sure to follow the rest of the ",(0,l.jsx)(t.a,{href:"/docs/bundleMode/setup/",children:"setup instructions"})," after enabling this flag."]}),"\n",(0,l.jsxs)(t.h3,{id:"fetch_preview_enabled-",children:[(0,l.jsx)(t.code,{children:"FETCH_PREVIEW_ENABLED"})," ",(0,l.jsx)(n,{version:"0.8.0"})]}),"\n",(0,l.jsxs)(t.p,{children:["This feature flag enables the ",(0,l.jsx)(t.a,{href:"/docs/bundleMode/usage#running-network-requests-in-worklets",children:"preview of fetch API on Worklet Runtimes"})," in the ",(0,l.jsx)(t.a,{href:"/docs/bundleMode/",children:"Bundle Mode"}),". Make sure to follow the rest of the ",(0,l.jsx)(t.a,{href:"/docs/bundleMode/setup/",children:"setup instructions"})," after enabling this flag.\n",(0,l.jsxs)(t.strong,{children:["This flag requires ",(0,l.jsx)(t.code,{children:"BUNDLE_MODE_ENABLED"})," flag to be enabled as well."]})]}),"\n",(0,l.jsxs)(t.h3,{id:"ios_dynamic_framerate_enabled-",children:[(0,l.jsx)(t.code,{children:"IOS_DYNAMIC_FRAMERATE_ENABLED"})," ",(0,l.jsx)(n,{version:"0.6.0"})]}),"\n",(0,l.jsxs)(t.p,{children:["This feature flags is supposed to improve the visual perception and perceived smoothness of computationally expensive animations. When enabled, the frame rate will be automatically adjusted for current workload of the UI thread. For instance, if the device fails to run animations in 120 fps which would usually results in irregular frame drops, the mechanism will fallback to stable 60 fps. For more details, see ",(0,l.jsx)(t.a,{href:"https://github.com/software-mansion/react-native-reanimated/pull/7624",children:"PR #7624"}),"."]}),"\n",(0,l.jsx)(t.h2,{id:"static-feature-flags",children:"Static feature flags"}),"\n",(0,l.jsx)(t.p,{children:"Static flags are intended to be resolved during code compilation and cannot be changed during application runtime. To enable a static feature flag, you need to:"}),"\n",(0,l.jsxs)(t.ol,{children:["\n",(0,l.jsxs)(t.li,{children:["Add the following lines to ",(0,l.jsx)(t.code,{children:"package.json"})," of your app"]}),"\n"]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-json",children:'{\n  // ...\n  "worklets": {\n    "staticFeatureFlags": {\n      "EXAMPLE_STATIC_FLAG": true\n    }\n  }\n}\n'})}),"\n",(0,l.jsxs)(t.ol,{start:"2",children:["\n",(0,l.jsxs)(t.li,{children:["Run ",(0,l.jsx)(t.code,{children:"pod install"})," (iOS only)"]}),"\n",(0,l.jsx)(t.li,{children:"Rebuild the native app"}),"\n"]}),"\n",(0,l.jsxs)(t.admonition,{type:"warning",children:[(0,l.jsxs)(t.p,{children:["Static feature flags are not supported in environments where Worklets is prebuilt with the default configuration of flags, like for instance in ",(0,l.jsx)(t.a,{href:"https://expo.dev/go",children:"Expo Go"})," and ",(0,l.jsx)(t.a,{href:"https://rnrepo.org/",children:"RNRepo"}),"."]}),(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsxs)(t.li,{children:["It's not possible to modify static feature flags in Expo Go. Please consider using ",(0,l.jsx)(t.a,{href:"https://docs.expo.dev/workflow/continuous-native-generation/",children:"Expo Prebuild"})," instead."]}),"\n",(0,l.jsxs)(t.li,{children:["If your project uses RNRepo, you need to force building Worklets from source by adding it to the deny list as described in ",(0,l.jsx)(t.a,{href:"https://github.com/software-mansion/rnrepo/blob/main/TROUBLESHOOTING.md#deny-list-configuration",children:"RNRepo's documentation"}),"."]}),"\n"]})]}),"\n",(0,l.jsxs)(t.p,{children:["To read a static feature flag value in JavaScript, you can use ",(0,l.jsx)(t.code,{children:"getStaticFeatureFlag"})," function."]}),"\n",(0,l.jsx)(t.h2,{id:"dynamic-feature-flags",children:"Dynamic feature flags"}),"\n",(0,l.jsxs)(t.p,{children:["Dynamic flags can be modified during runtime and their values can change at any moment of app lifetime. To enable or disable a dynamic feature flag, you need to call ",(0,l.jsx)(t.code,{children:"setDynamicFeatureFlag"})," function."]}),"\n",(0,l.jsx)(t.pre,{children:(0,l.jsx)(t.code,{className:"language-tsx",children:"import { setDynamicFeatureFlag } from 'react-native-worklets';\n\nsetDynamicFeatureFlag('EXAMPLE_DYNAMIC_FLAG', true);\n"})}),"\n",(0,l.jsxs)(t.p,{children:["To read a dynamic feature flag value in JavaScript, you can use ",(0,l.jsx)(t.code,{children:"getDynamicFeatureFlag"})," function."]}),"\n",(0,l.jsx)(t.h2,{id:"comparison-of-static-and-dynamic-feature-flags",children:"Comparison of static and dynamic feature flags"}),"\n",(0,l.jsxs)(t.table,{children:[(0,l.jsx)(t.thead,{children:(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.th,{}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"Static feature flags"}),(0,l.jsx)(t.th,{style:{textAlign:"center"},children:"Dynamic feature flags"})]})}),(0,l.jsxs)(t.tbody,{children:[(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{children:"Value is known during app build"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{children:"Value may change during app lifetime"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{children:"Value change requires app rebuild"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{children:"Can be changed via public JavaScript API"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsxs)(t.td,{children:["Can be changed via app's ",(0,l.jsx)(t.code,{children:"package.json"})]}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"})]}),(0,l.jsxs)(t.tr,{children:[(0,l.jsx)(t.td,{children:"Can be changed when using Expo Go or RNRepo"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"}),(0,l.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"})]})]})]}),"\n",(0,l.jsx)(t.h2,{id:"remarks-for-contributors",children:"Remarks for contributors"}),"\n",(0,l.jsxs)(t.ul,{children:["\n",(0,l.jsx)(t.li,{children:"Feature flags should switch the implementation to the new experimental behavior only when enabled."}),"\n",(0,l.jsx)(t.li,{children:"Initially, the default value should be false, allowing users to opt-in for the experimental behavior when desired."}),"\n",(0,l.jsx)(t.li,{children:"When the experimental behavior is considered stable, the default value should be set to true, while still allowing users to opt-out if needed."}),"\n",(0,l.jsx)(t.li,{children:"After some period, the feature flag which is enabled by default should be removed from the codebase."}),"\n",(0,l.jsxs)(t.li,{children:["Both static and dynamic feature flags should follow upper snake case, i.e. ",(0,l.jsx)(t.code,{children:"EXAMPLE_FEATURE_FLAG"}),"."]}),"\n",(0,l.jsxs)(t.li,{children:["The name of the feature flag should not contain the expression ",(0,l.jsx)(t.code,{children:"FEATURE_FLAG"})," itself."]}),"\n",(0,l.jsxs)(t.li,{children:["It is recommended to explicitly use ",(0,l.jsx)(t.code,{children:"ENABLE_"})," or ",(0,l.jsx)(t.code,{children:"DISABLE_"})," prefix for feature flags that enable or disable certain parts of the code for the sake of clarity."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,l.jsx)(t,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);