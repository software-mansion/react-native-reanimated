"use strict";(globalThis.webpackChunkdocs_worklets=globalThis.webpackChunkdocs_worklets||[]).push([[2754],{22266:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"worklets-babel-plugin/plugin-options","title":"Options","description":"Our plugin offers several optional functionalities that you may need to employ advanced APIs:","source":"@site/docs/worklets-babel-plugin/options.md","sourceDirName":"worklets-babel-plugin","slug":"/worklets-babel-plugin/plugin-options","permalink":"/react-native-worklets/docs/worklets-babel-plugin/plugin-options","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-reanimated/edit/main/docs/docs-worklets/docs/worklets-babel-plugin/options.md","tags":[],"version":"current","frontMatter":{"id":"plugin-options","title":"Options","sidebar_label":"Options"},"sidebar":"tutorialSidebar","previous":{"title":"About","permalink":"/react-native-worklets/docs/worklets-babel-plugin/about"},"next":{"title":"Guides","permalink":"/react-native-worklets/docs/category/guides"}}');var l=s(47671),i=s(30620);const o={id:"plugin-options",title:"Options",sidebar_label:"Options"},a="Options for Worklets Babel Plugin",r={},c=[{value:"How to use",id:"how-to-use",level:2},{value:"Options",id:"options",level:2},{value:"bundleMode",id:"bundlemode",level:3},{value:"disableInlineStylesWarning",id:"disableinlinestyleswarning",level:3},{value:"disableSourceMaps",id:"disablesourcemaps",level:3},{value:"disableWorkletClasses <AvailableFrom></AvailableFrom>",id:"disableworkletclasses-",level:3},{value:"extraPlugins",id:"extraplugins",level:3},{value:"extraPresets",id:"extrapresets",level:3},{value:"globals",id:"globals",level:3},{value:"omitNativeOnlyData",id:"omitnativeonlydata",level:3},{value:"relativeSourceLocation",id:"relativesourcelocation",level:3},{value:"strictGlobal <AvailableFrom></AvailableFrom>",id:"strictglobal-",level:3},{value:"substituteWebPlatformChecks",id:"substitutewebplatformchecks",level:3},{value:"workletizableModules",id:"workletizablemodules",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components},{AvailableFrom:s,Details:t}=n;return s||u("AvailableFrom",!0),t||u("Details",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"options-for-worklets-babel-plugin",children:"Options for Worklets Babel Plugin"})}),"\n",(0,l.jsx)(n.p,{children:"Our plugin offers several optional functionalities that you may need to employ advanced APIs:"}),"\n",(0,l.jsxs)(t,{children:[(0,l.jsx)("summary",{children:"Type definitions"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"interface PluginOptions {\n  bundleMode?: boolean;\n  disableInlineStylesWarning?: boolean;\n  disableSourceMaps?: boolean;\n  disableWorkletClasses?: boolean;\n  extraPlugins?: string[];\n  extraPresets?: string[];\n  globals?: string[];\n  omitNativeOnlyData?: boolean;\n  relativeSourceLocation?: boolean;\n  strictGlobal?: boolean;\n  substituteWebPlatformChecks?: boolean;\n  workletizableModules?: string[];\n}\n"})})]}),"\n",(0,l.jsx)(n.h2,{id:"how-to-use",children:"How to use"}),"\n",(0,l.jsxs)(n.p,{children:["Using this is straightforward for Babel plugins; you just need to pass an object containing the options to the plugin in your ",(0,l.jsx)(n.code,{children:"babel.config.js"})," file. Make sure to pass the plugin and its options as a ",(0,l.jsx)(n.strong,{children:"two-element array"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"Here's an example:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-js",metastring:"{13-16}",children:"/** @type {import('react-native-worklets/plugin').PluginOptions} */\nconst workletsPluginOptions = {\n  bundleMode: true,\n  disableInlineStylesWarning: true,\n  globals: ['myObjectOnUI'],\n  substituteWebPlatformChecks: true,\n}\n\nmodule.exports = {\n  ...\n  plugins: [\n    ...\n    [\n      'react-native-worklets/plugin',\n      workletsPluginOptions\n    ],\n  ],\n};\n"})}),"\n",(0,l.jsx)(n.h2,{id:"options",children:"Options"}),"\n",(0,l.jsx)(n.h3,{id:"bundlemode",children:"bundleMode"}),"\n",(0,l.jsxs)(n.p,{children:["Defaults to ",(0,l.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["Enables the ",(0,l.jsx)(n.a,{href:"/docs/bundleMode/",children:"Bundle Mode"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"disableinlinestyleswarning",children:"disableInlineStylesWarning"}),"\n",(0,l.jsxs)(n.p,{children:["Defaults to ",(0,l.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["Turning on this option suppresses a helpful warning when you use ",(0,l.jsx)(n.a,{href:"https://docs.swmansion.com/react-native-reanimated/docs/fundamentals/glossary#animations-in-inline-styling",children:"inline shared values"})," and might unintentionally write:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"import Animated, {useSharedValue} from 'react-native-reanimated';\n\nfunction MyView() {\n  const width = useSharedValue(100);\n  return <Animated.View style={{ width: width.value }}>; // Loss of reactivity when using `width.value` instead of `width`!\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["You'll receive a warning about accessing ",(0,l.jsx)(n.code,{children:"value"})," in an inline prop and the potential loss of reactivity that it causes. However, because there's no fail-safe mechanism that checks if the accessed property ",(0,l.jsx)(n.code,{children:"value"})," comes from a Shared Value during Babel transpilation, it might cause problems:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"import { View } from 'react-native';\n\ninterface MyProps {\n  taggedWidth: {\n    tag: string;\n    value: number;\n  };\n}\n\nfunction MyView({ taggedWidth }) {\n  return <View style={{ width: taggedWidth.value }} />; // This triggers a false warning.\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"Enable this option to silence such false warnings."}),"\n",(0,l.jsx)(n.h3,{id:"disablesourcemaps",children:"disableSourceMaps"}),"\n",(0,l.jsxs)(n.p,{children:["Defaults to ",(0,l.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"This option turns off the source map generation for worklets. Mostly used for testing purposes."}),"\n",(0,l.jsxs)(n.h3,{id:"disableworkletclasses-",children:["disableWorkletClasses ",(0,l.jsx)(s,{version:"0.7.0"})]}),"\n",(0,l.jsxs)(n.p,{children:["Defaults to ",(0,l.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["Disables ",(0,l.jsx)(n.a,{href:"/docs/worklets-babel-plugin/about#experimental-worklet-classes",children:"Worklet Classes\nsupport"}),".\nYou might need to disable this feature when using ",(0,l.jsx)(n.a,{href:"/docs/memory/registerCustomSerializable",children:"Custom\nSerializables"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"extraplugins",children:"extraPlugins"}),"\n",(0,l.jsx)(n.p,{children:"Defaults to an empty array."}),"\n",(0,l.jsx)(n.p,{children:"This is a list of Babel plugins that will be used when transforming worklets' code with Worklets Babel Plugin."}),"\n",(0,l.jsx)(n.h3,{id:"extrapresets",children:"extraPresets"}),"\n",(0,l.jsx)(n.p,{children:"Defaults to an empty array."}),"\n",(0,l.jsx)(n.p,{children:"This is a list of Babel presets that will be used when transforming worklets' code with Worklets Babel Plugin."}),"\n",(0,l.jsx)(n.h3,{id:"globals",children:"globals"}),"\n",(0,l.jsx)(n.p,{children:"Defaults to an empty array."}),"\n",(0,l.jsx)(n.p,{children:"This is a list of identifiers (objects) that will not be copied to the UI thread if a worklet requires them. For instance:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"const someReference = 5;\nfunction foo() {\n  'worklet';\n  return someReference + 1;\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["In this example, ",(0,l.jsx)(n.code,{children:"someReference"})," is not accessible on the UI thread. Consequently, we must copy it there, ensuring correct scoping, to keep the worklet from failing. But, consider this:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"function bar() {\n  'worklet';\n  return null;\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Here, the identifier ",(0,l.jsx)(n.code,{children:"null"})," is already accessible on the UI thread. Therefore, we don't need to copy it and use a copied value there. While it might not immediately seem particularly useful to avoid copying the value, consider the following case:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"function setOnJS() {\n  global.something = 'JS THREAD';\n}\n\nfunction setOnUI() {\n  'worklet';\n  global.something = 'UI THREAD';\n}\n\nfunction readFromJS() {\n  console.log(global.something);\n}\n\nfunction readFromUI() {\n  'worklet';\n  console.log(global.something);\n}\n\nfunction run() {\n  setOnJS();\n  runOnUI(setOnUI)();\n  readFromJS();\n  runOnUI(readFromUI)();\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Without ",(0,l.jsx)(n.code,{children:"global"})," as an blocklisted identifier in this case, you'd only get:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"JS THREAD\nJS THREAD\n"})}),"\n",(0,l.jsxs)(n.p,{children:["This output occurs because the entire ",(0,l.jsx)(n.code,{children:"global"})," object (!) would be copied to the UI thread for it to be assigned by ",(0,l.jsx)(n.code,{children:"setOnUI"}),". Then, ",(0,l.jsx)(n.code,{children:"readOnUI"})," would again copy the ",(0,l.jsx)(n.code,{children:"global"})," object and read from this copy."]}),"\n",(0,l.jsxs)(n.p,{children:["There is a ",(0,l.jsx)(n.a,{href:"https://github.com/software-mansion/react-native-reanimated/blob/main/packages/react-native-worklets/plugin/src/globals.ts",children:"huge list of identifiers blocklisted by default"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"omitnativeonlydata",children:"omitNativeOnlyData"}),"\n",(0,l.jsxs)(n.p,{children:["Defaults to ",(0,l.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"This option comes in handy for Web apps. Because Babel ordinarily doesn't get information about the target platform, it includes worklet data in the bundle that only Native apps find relevant. If you enable this option, your bundle size will be smaller."}),"\n",(0,l.jsx)(n.h3,{id:"relativesourcelocation",children:"relativeSourceLocation"}),"\n",(0,l.jsxs)(n.p,{children:["Defaults to ",(0,l.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["This option dictates the passed file location for a worklet's source map. If you enable this option, the file paths will be relative to ",(0,l.jsx)(n.code,{children:"process.cwd"})," (the current directory where Babel executes). This can be handy for Jest test snapshots to ensure consistent results across machines."]}),"\n",(0,l.jsxs)(n.h3,{id:"strictglobal-",children:["strictGlobal ",(0,l.jsx)(s,{version:"0.8.0"})]}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsx)(n.p,{children:"We highly recommend enabling this option as it will be enabled by default in the future."})}),"\n",(0,l.jsxs)(n.p,{children:["Defaults to ",(0,l.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["This option changes how global variables are handled inside worklets. You can read more about closures and global scoping ",(0,l.jsx)(n.a,{href:"/docs/fundamentals/closures#global-scoping",children:"here"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"With this option disabled, accessing global variables inside worklets will lead to capturing them from the scheduler scope:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"global.something = 10;\n\nfunction setOnUI() {\n  'worklet';\n  console.log(something); // Captured from scheduler scope, prints 10\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["When you enable ",(0,l.jsx)(n.code,{children:"strictGlobal"}),", accessing a global variable inside a worklet will result in accessing it directly from the global scope of the worklet runtime:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"global.something = 10;\n\nfunction setOnUI() {\n  'worklet';\n  console.log(something); // undefined - accessed from worklet global scope\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"To actually access the global variable from another runtime you must assign it to a local variable and use it in the worklet:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-tsx",children:"global.something = 10;\nconst localSomething = global.something;\n\nfunction setOnUI() {\n  'worklet';\n  console.log(localSomething); // prints 10\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["While it might seem handy to copy everything implicitly, it can lead to unexpected behavior when the captured object shouldn't be copied between runtimes. Compare this to the ",(0,l.jsx)(n.a,{href:"#globals",children:"globals option"}),", which allows you to specify which global variables should not be copied to the worklet runtime at all."]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"strictGlobal"})," takes precedence over the ",(0,l.jsx)(n.code,{children:"globals"})," option."]}),"\n",(0,l.jsx)(n.h3,{id:"substitutewebplatformchecks",children:"substituteWebPlatformChecks"}),"\n",(0,l.jsxs)(n.p,{children:["Defaults to ",(0,l.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:["This option can also be useful for Web apps. In Reanimated, there are numerous checks to determine the right function implementation for a specific target platform. Enabling this option changes all the checks that identify if the target is a Web app to ",(0,l.jsx)(n.code,{children:"true"}),". This alteration can aid in tree-shaking and contribute to reducing the bundle size."]}),"\n",(0,l.jsx)(n.h3,{id:"workletizablemodules",children:"workletizableModules"}),"\n",(0,l.jsx)(n.p,{children:"Defaults to an empty array."}),"\n",(0,l.jsxs)(n.p,{children:["This option allows you to register modules as safe to use on Worklet Runtimes in the ",(0,l.jsx)(n.a,{href:"/docs/bundleMode/",children:"Bundle Mode"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}function u(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},30620:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(39471);const l={},i=t.createContext(l);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);