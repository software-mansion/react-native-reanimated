"use strict";(globalThis.webpackChunkdocs_reanimated=globalThis.webpackChunkdocs_reanimated||[]).push([[5780],{63963:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>b,contentTitle:()=>j,default:()=>v,frontMatter:()=>g,metadata:()=>r,toc:()=>y});const r=JSON.parse('{"id":"threading/runOnJS","title":"runOnJS","description":"runOnJS lets you asynchronously run non-workletized functions that couldn\'t otherwise run on the UI thread. This applies to most external libraries as they don\'t have their functions marked with \\"worklet\\"; directive.","source":"@site/versioned_docs/version-3.x/threading/runOnJS.mdx","sourceDirName":"threading","slug":"/threading/runOnJS","permalink":"/react-native-reanimated/docs/3.x/threading/runOnJS","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-reanimated/edit/main/docs/docs-reanimated/versioned_docs/version-3.x/threading/runOnJS.mdx","tags":[],"version":"3.x","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Threading","permalink":"/react-native-reanimated/docs/3.x/category/threading"},"next":{"title":"runOnUI","permalink":"/react-native-reanimated/docs/3.x/threading/runOnUI"}}');var i=t(47671),s=t(30620),a=t(39471),o=t(8589),d=t(90424),l=t(31071),c=t(31721),h=t(66515);const u={code:"function RunOnJSTsx1(){const{runOnJS,setFinished}=this.__closure;runOnJS(setFinished)(true);}"},m={code:"function RunOnJSTsx2(){const{scale}=this.__closure;return{transform:[{scale:scale.value}]};}"};function f(){const e=(0,h.useSharedValue)(1),[n,t]=a.useState(!1),r=(0,h.useAnimatedStyle)(function({_worklet_8738913883780_init_data:e,scale:n}){const t=()=>({transform:[{scale:n.value}]});return t.__closure={scale:n},t.__workletHash=8738913883780,t.__initData=e,t}({_worklet_8738913883780_init_data:m,scale:e}));return(0,i.jsxs)(o.A,{style:x.container,children:[(0,i.jsx)(h.default.View,{style:[x.box,r]}),(0,i.jsx)(d.A,{onPress:()=>{e.value=(0,h.withSpring)(2,{},function({_worklet_7767882256352_init_data:e,runOnJS:n,setFinished:t}){const r=function(){n(t)(!0)};return r.__closure={runOnJS:n,setFinished:t},r.__workletHash=7767882256352,r.__initData=e,r}({_worklet_7767882256352_init_data:u,runOnJS:h.runOnJS,setFinished:t}))},title:"Click me",disabled:n}),n&&(0,i.jsx)(l.A,{children:"Finished! \ud83c\udf89"})]})}const x=c.A.create({container:{flex:1,alignItems:"center"},box:{height:100,width:100,backgroundColor:"#b58df1",borderRadius:20,marginVertical:64,alignSelf:"center"}}),p="import React from 'react';\nimport { Button, View, StyleSheet, Text } from 'react-native';\nimport Animated, {\n  useSharedValue,\n  withSpring,\n  runOnJS,\n} from 'react-native-reanimated';\nimport { useAnimatedStyle } from 'react-native-reanimated';\n\nexport default function App() {\n  const scale = useSharedValue<number>(1);\n  const [finished, setFinished] = React.useState<boolean>(false);\n\n  const handlePress = () => {\n    scale.value = withSpring(2, {}, () => {\n      // highlight-next-line\n      runOnJS(setFinished)(true);\n    });\n  };\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  return (\n    <View style={styles.container}>\n      <Animated.View style={[styles.box, animatedStyle]} />\n      <Button onPress={handlePress} title=\"Click me\" disabled={finished} />\n      {finished && <Text>Finished! \ud83c\udf89</Text>}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n  },\n  box: {\n    height: 100,\n    width: 100,\n    backgroundColor: '#b58df1',\n    borderRadius: 20,\n    marginVertical: 64,\n    alignSelf: 'center',\n  },\n});\n",g={sidebar_position:1},j="runOnJS",b={},y=[{value:"Reference",id:"reference",level:2},{value:"Arguments",id:"arguments",level:3},{value:"fn",id:"fn",level:4},{value:"Returns",id:"returns",level:3},{value:"Example",id:"example",level:2},{value:"Remarks",id:"remarks",level:2},{value:"Platform compatibility",id:"platform-compatibility",level:2}];function S(e){const n={a:"a",admonition:"admonition",code:"code",del:"del",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Details:t,Indent:r,InteractiveExample:a,PlatformCompatibility:o}=n;return t||w("Details",!0),r||w("Indent",!0),a||w("InteractiveExample",!0),o||w("PlatformCompatibility",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"runonjs",children:"runOnJS"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"runOnJS"})," lets you asynchronously run non-",(0,i.jsx)(n.a,{href:"/docs/fundamentals/glossary#to-workletize",children:"workletized"})," functions that couldn't otherwise run on the ",(0,i.jsx)(n.a,{href:"/docs/fundamentals/glossary#ui-thread",children:"UI thread"}),". This applies to most external libraries as they don't have their functions marked with ",(0,i.jsx)(n.code,{children:'"worklet";'})," directive."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"runOnJS"})," is usually used to update React state either on animation finish or conditionally within a gesture."]}),"\n",(0,i.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import { runOnJS } from 'react-native-reanimated';\n\nfunction App() {\n  // While on the UI thread\n  runOnJS(navigation.goBack)();\n}\n"})}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Type definitions"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function runOnJS<A extends any[], R>(\n  fn: (...args: A) => R\n): (...args: Parameters<typeof fn>) => void;\n"})})]}),"\n",(0,i.jsx)(n.h3,{id:"arguments",children:"Arguments"}),"\n",(0,i.jsx)(n.h4,{id:"fn",children:"fn"}),"\n",(0,i.jsxs)(n.p,{children:["A reference to a function you want to execute on the ",(0,i.jsx)(n.a,{href:"/docs/fundamentals/glossary#javascript-thread",children:"JavaScript thread"})," from the ",(0,i.jsx)(n.a,{href:"/docs/fundamentals/glossary#ui-thread",children:"UI thread"}),". Arguments to your function have to be passed to the function returned from ",(0,i.jsx)(n.code,{children:"runOnJS"})," i.e. ",(0,i.jsx)(n.code,{children:"runOnJS(setValue)(10);"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"returns",children:"Returns"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"runOnJS"})," returns a function that accepts arguments for the function passed as the first argument. This function can be safely executed on the UI thread."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Don't forget to call the function returned from ",(0,i.jsx)(n.code,{children:"runOnJS"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n","\n",(0,i.jsx)(a,{src:p,component:f}),"\n",(0,i.jsx)(n.h2,{id:"remarks",children:"Remarks"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Functions passed to ",(0,i.jsx)(n.code,{children:"runOnJS"})," must be defined in the ",(0,i.jsx)(n.a,{href:"/docs/fundamentals/glossary#javascript-thread",children:"JavaScript thread"})," scope, i.e. in the component body or the global scope. This code won't work because ",(0,i.jsx)(n.code,{children:"myFunction"})," is defined in the ",(0,i.jsx)(n.code,{children:"withTiming"})," callback, which is only executed in the ",(0,i.jsx)(n.a,{href:"/docs/fundamentals/glossary#ui-thread",children:"UI thread"}),":"]}),"\n"]}),"\n",(0,i.jsx)(r,{children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsx",children:"withTiming(0, {}, () => {\n  // myFunction is defined on the UI thread \ud83d\udea8\n  const myFunction = () => {\n    // ...\n  };\n  runOnJS(myFunction)(); // \ud83d\udca5\n});\n"})})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["It's a common mistake to execute function inside of runOnJS like this: ",(0,i.jsx)(n.del,{children:(0,i.jsx)(n.code,{children:"runOnJS(setValue(10))()"})}),". Here, the correct usage would be ",(0,i.jsx)(n.code,{children:"runOnJS(setValue)(10)"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["It's safe to run functions via ",(0,i.jsx)(n.code,{children:"runOnJS"})," on the ",(0,i.jsx)(n.a,{href:"/docs/fundamentals/glossary#javascript-thread",children:"JavaScript thread"}),", as this has no effect."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"platform-compatibility",children:"Platform compatibility"}),"\n",(0,i.jsx)(o,{android:!0,ios:!0,web:!0})]})}function v(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(S,{...e})}):S(e)}function w(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},90424:(e,n,t)=>{t.d(n,{A:()=>l});var r=t(39471),i=t(31721),s=t(21844),a=t(31071),o=r.forwardRef((e,n)=>{var t=e.accessibilityLabel,i=e.color,o=e.disabled,l=e.onPress,c=e.testID,h=e.title;return r.createElement(s.A,{accessibilityLabel:t,accessibilityRole:"button",disabled:o,focusable:!o,onPress:l,ref:n,style:[d.button,i&&{backgroundColor:i},o&&d.buttonDisabled],testID:c},r.createElement(a.A,{style:[d.text,o&&d.textDisabled]},h))});o.displayName="Button";var d=i.A.create({button:{backgroundColor:"#2196F3",borderRadius:2},text:{color:"#fff",fontWeight:"500",padding:8,textAlign:"center",textTransform:"uppercase"},buttonDisabled:{backgroundColor:"#dfdfdf"},textDisabled:{color:"#a1a1a1"}});const l=o}}]);