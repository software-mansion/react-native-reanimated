"use strict";(self.webpackChunkdocs_reanimated=self.webpackChunkdocs_reanimated||[]).push([[1161],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>i});var r=t(96540);const a={},o=r.createContext(a);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(o.Provider,{value:n},e.children)}},63220:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"guides/worklets","title":"Worklets","description":"Worklets are short-running JavaScript functions that can run on the UI thread. Reanimated uses worklets to calculate view styles and react to events on the UI thread.","source":"@site/versioned_docs/version-3.x/guides/worklets.mdx","sourceDirName":"guides","slug":"/guides/worklets","permalink":"/react-native-reanimated/docs/guides/worklets","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-reanimated/edit/main/packages/docs-reanimated/versioned_docs/version-3.x/guides/worklets.mdx","tags":[],"version":"3.x","sidebarPosition":1,"frontMatter":{"id":"worklets","sidebar_label":"Worklets","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Guides","permalink":"/react-native-reanimated/docs/category/guides"},"next":{"title":"Accessibility","permalink":"/react-native-reanimated/docs/guides/accessibility"}}');var a=t(74848),o=t(28453);const s={id:"worklets",sidebar_label:"Worklets",sidebar_position:1},i="Worklets",c={},l=[];function d(e){const n={a:"a",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"worklets",children:"Worklets"})}),"\n",(0,a.jsxs)(n.p,{children:["Worklets are short-running JavaScript functions that can run on the ",(0,a.jsx)(n.a,{href:"/docs/fundamentals/glossary#ui-thread",children:"UI thread"}),". Reanimated uses worklets to calculate view styles and react to events on the UI thread."]}),"\n",(0,a.jsxs)(n.p,{children:["You can create your own worklets using the ",(0,a.jsx)(n.code,{children:"'worklet';"})," directive at the top of a function."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"function myWorklet() {\n  'worklet';\n  console.log('Hello from a worklet');\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.a,{href:"https://github.com/software-mansion/react-native-reanimated/blob/main/packages/react-native-worklets/plugin/README-dev.md#basics",children:"Reanimated Babel Plugin"})," looks for functions marked with the ",(0,a.jsx)(n.code,{children:"'worklet'"})," directive and converts them into serializable objects. We call this process ",(0,a.jsx)(n.a,{href:"/docs/fundamentals/glossary#to-workletize",children:"workletization"}),". These objects can then be copied and run over on the UI thread."]}),"\n",(0,a.jsxs)(n.p,{children:["Most of the time when working with Reanimated and ",(0,a.jsx)(n.a,{href:"https://docs.swmansion.com/react-native-gesture-handler/",children:"Gesture Handler"})," the code is automatically workletized and run on the UI thread by default."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"import { useAnimatedStyle } from 'react-native-reanimated';\n\nfunction App() {\n  const style = useAnimatedStyle(() => {\n    // Running on the UI thread\n    return { opacity: 0.5 };\n  });\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Functions marked with ",(0,a.jsx)(n.code,{children:"'worklet';"})," aren't ",(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Glossary/Hoisting",children:"hoisted"}),". Besides affecting hoisting, the ",(0,a.jsx)(n.code,{children:"'worklet';"})," directive has no effect on the ",(0,a.jsx)(n.a,{href:"/docs/fundamentals/glossary#javascript-thread",children:"JavaScript thread"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:["You can use ",(0,a.jsx)(n.a,{href:"/docs/threading/runOnUI",children:(0,a.jsx)(n.code,{children:"runOnUI"})})," to manually schedule worklet execution on the UI thread:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"function myWorklet() {\n  'worklet';\n  console.log('Hello from the UI thread');\n}\n\nfunction onPress() {\n  runOnUI(myWorklet)();\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"You can pass arguments to worklets."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"function myWorklet(greeting) {\n  'worklet';\n  console.log(`${greeting} from the UI thread`);\n}\n\nfunction onPress() {\n  runOnUI(myWorklet)('Howdy');\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Worklets are ",(0,a.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures",children:"closures"}),". They can access variables declared outside of their own scope. Only variables referenced in the worklet body will be captured inside the worklet scope."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const width = 135.5;\n\nfunction otherWorklet() {\n  'worklet';\n  console.log('Captured width is', width);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Capturing large JavaScript objects inside of a worklet can lead to performance issues."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const theme = {...}; // theme is a large object\n\nfunction myWorklet() {\n  'worklet';\n  console.log(theme.color); // \ud83d\udea8 referenced `color` but captured the whole `theme` object\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"You can get around this problem by first assigning the prop you want to use to a separate variable."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"const theme = {...};\nconst color = theme.color;\n\nfunction myWorklet() {\n  'worklet';\n  console.log(color); // \u2705 captured only `color`\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Worklets can return data within the same thread."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"function returningWorklet() {\n  'worklet';\n  return \"I'm back\"; // on the UI thread\n}\n\nfunction someWorklet() {\n  'worklet';\n  const what = returningWorklet(); // still on the UI thread\n  console.log('On the UI thread, other worklet says', what);\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["To pass data between UI and JS thread we use ",(0,a.jsx)(n.a,{href:"/docs/fundamentals/glossary#shared-value",children:"shared values"}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"import { useSharedValue } from 'react-native-reanimated';\n\nfunction App() {\n  const width = useSharedValue(100);\n\n  function myWorklet() {\n    'worklet';\n    width.value += 50;\n  }\n\n  useEffect(() => {\n    console.log(width.value); // available on both JS and UI thread\n  }, []);\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["You can run functions on the JS thread from the UI thread with ",(0,a.jsx)(n.a,{href:"/docs/threading/runOnJS",children:(0,a.jsx)(n.code,{children:"runOnJS"})}),". Most frequently used to call functions that aren't marked with a ",(0,a.jsx)(n.code,{children:"'worklet';"})," directive (i.e. most third-party libraries) or to update the React state."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"import { router } from 'expo-router';\nimport { Gesture } from 'react-native-gesture-handler';\n\nfunction App() {\n  const tap = Gesture.Tap().onEnd(() => {\n    // i'm a worklet too!\n    // highlight-next-line\n    runOnJS(router.back)();\n  });\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Functions passed to ",(0,a.jsx)(n.code,{children:"runOnJS"})," must be defined in the ",(0,a.jsx)(n.a,{href:"/docs/fundamentals/glossary#javascript-thread",children:"JavaScript thread"})," scope, i.e. in the component body or the global scope. This code won't work because ",(0,a.jsx)(n.code,{children:"myFunction"})," is defined in the ",(0,a.jsx)(n.code,{children:"withTiming"})," callback, which is only executed in the ",(0,a.jsx)(n.a,{href:"/docs/fundamentals/glossary#ui-thread",children:"UI thread"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-javascript",children:"function App() {\n  const tap = Gesture.Tap().onEnd(() => {\n    // myFunction is defined on the UI thread \ud83d\udea8\n    const myFunction = () => {};\n    runOnJS(myFunction)(); // \ud83d\udca5\n  });\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Worklets can run in other runtimes than the one provided by Reanimated. For example ",(0,a.jsx)(n.a,{href:"https://github.com/mrousavy/react-native-vision-camera",children:"VisionCamera"})," and ",(0,a.jsx)(n.a,{href:"https://github.com/Expensify/react-native-live-markdown",children:"LiveMarkdown"})," create their own worklet runtimes."]}),"\n",(0,a.jsxs)(n.p,{children:["You can create your own worklet runtimes with ",(0,a.jsx)(n.a,{href:"/docs/threading/createWorkletRuntime",children:(0,a.jsx)(n.code,{children:"createWorkletRuntime"})})," function."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);