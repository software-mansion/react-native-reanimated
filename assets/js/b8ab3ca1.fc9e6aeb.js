"use strict";(self.webpackChunkdocs_reanimated=self.webpackChunkdocs_reanimated||[]).push([[6604],{30620:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var a=n(39471);const i={},l=a.createContext(i);function s(e){const t=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(l.Provider,{value:t},e.children)}},69192:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"guides/feature-flags","title":"Feature flags","description":"Feature flags allow developers to opt-in for experimental changes or opt-out from recent changes that have already been made default. Feature flags serve as a tool for incremental rollout of new implementation without affecting the general stability of the library, allowing to gather feedback from early adopters. There are two types of feature flags: static and dynamic.","source":"@site/docs/guides/feature-flags.md","sourceDirName":"guides","slug":"/guides/feature-flags","permalink":"/react-native-reanimated/docs/guides/feature-flags","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-reanimated/edit/main/packages/docs-reanimated/docs/guides/feature-flags.md","tags":[],"version":"current","frontMatter":{"id":"feature-flags","title":"Feature flags","sidebar_label":"Feature flags"},"sidebar":"tutorialSidebar","previous":{"title":"Debugging worklets","permalink":"/react-native-reanimated/docs/guides/debugging"},"next":{"title":"Migration from 1.x","permalink":"/react-native-reanimated/docs/guides/migration-from-1.x"}}');var i=n(47671),l=n(30620);const s={id:"feature-flags",title:"Feature flags",sidebar_label:"Feature flags"},r=void 0,o={},c=[{value:"Summary of available feature flags",id:"summary-of-available-feature-flags",level:2},{value:"Description of available feature flags",id:"description-of-available-feature-flags",level:2},{value:"<code>DISABLE_COMMIT_PAUSING_MECHANISM</code>",id:"disable_commit_pausing_mechanism",level:3},{value:"<code>ANDROID_SYNCHRONOUSLY_UPDATE_UI_PROPS</code>",id:"android_synchronously_update_ui_props",level:3},{value:"<code>EXPERIMENTAL_CSS_ANIMATIONS_FOR_SVG_COMPONENTS</code>",id:"experimental_css_animations_for_svg_components",level:3},{value:"<code>USE_SYNCHRONIZABLE_FOR_MUTABLES</code>",id:"use_synchronizable_for_mutables",level:3},{value:"Static feature flags",id:"static-feature-flags",level:2},{value:"Dynamic feature flags",id:"dynamic-feature-flags",level:2},{value:"Comparison of static and dynamic feature flags",id:"comparison-of-static-and-dynamic-feature-flags",level:2},{value:"Remarks for contributors",id:"remarks-for-contributors",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Feature flags allow developers to opt-in for experimental changes or opt-out from recent changes that have already been made default. Feature flags serve as a tool for incremental rollout of new implementation without affecting the general stability of the library, allowing to gather feedback from early adopters. There are two types of feature flags: static and dynamic."}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsx)(t.p,{children:"Feature flags are available since Reanimated 4."})}),"\n",(0,i.jsx)(t.h2,{id:"summary-of-available-feature-flags",children:"Summary of available feature flags"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Feature flag name"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Type"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Added in"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Removed in"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Default value"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"#disable_commit_pausing_mechanism",children:(0,i.jsx)(t.code,{children:"DISABLE_COMMIT_PAUSING_MECHANISM"})})}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:(0,i.jsx)(t.a,{href:"#static-feature-flags",children:"static"})}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"4.0.0"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u2013"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:(0,i.jsx)(t.code,{children:"false"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"#android_synchronously_update_ui_props",children:(0,i.jsx)(t.code,{children:"ANDROID_SYNCHRONOUSLY_UPDATE_UI_PROPS"})})}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:(0,i.jsx)(t.a,{href:"#static-feature-flags",children:"static"})}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"4.0.0"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u2013"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:(0,i.jsx)(t.code,{children:"false"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"#experimental_css_animations_for_svg_components",children:(0,i.jsx)(t.code,{children:"EXPERIMENTAL_CSS_ANIMATIONS_FOR_SVG_COMPONENTS"})})}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:(0,i.jsx)(t.a,{href:"#static-feature-flags",children:"static"})}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"4.1.0"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u2013"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:(0,i.jsx)(t.code,{children:"false"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"#use_synchronizable_for_mutables",children:(0,i.jsx)(t.code,{children:"USE_SYNCHRONIZABLE_FOR_MUTABLES"})})}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:(0,i.jsx)(t.a,{href:"#static-feature-flags",children:"static"})}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"4.1.0"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u2013"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:(0,i.jsx)(t.code,{children:"false"})})]})]})]}),"\n",(0,i.jsx)(t.admonition,{type:"info",children:(0,i.jsxs)(t.p,{children:["Feature flags available in ",(0,i.jsx)(t.code,{children:"react-native-worklets"})," are listed ",(0,i.jsx)(t.a,{href:"https://docs.swmansion.com/react-native-worklets/docs/guides/feature-flags",children:"on this page"}),"."]})}),"\n",(0,i.jsx)(t.h2,{id:"description-of-available-feature-flags",children:"Description of available feature flags"}),"\n",(0,i.jsx)(t.h3,{id:"disable_commit_pausing_mechanism",children:(0,i.jsx)(t.code,{children:"DISABLE_COMMIT_PAUSING_MECHANISM"})}),"\n",(0,i.jsxs)(t.p,{children:["When enabled, this feature flag is supposed to eliminate jittering of animated components like sticky header while scrolling. This feature flag is safe to enable only if ",(0,i.jsx)(t.code,{children:"preventShadowTreeCommitExhaustion"})," feature flag from ",(0,i.jsx)(t.code,{children:"react-native"})," (available since React Native 0.81) is also enabled \u2013 see instructions below. In all other cases it can lead to unresponsiveness of the app due to the starvation of React commits. For more details, see ",(0,i.jsx)(t.a,{href:"https://github.com/software-mansion/react-native-reanimated/pull/7852",children:"PR #7852"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["In React Native 0.81, ",(0,i.jsx)(t.code,{children:"preventShadowTreeCommitExhaustion"})," feature flag can be enabled by setting experimental release level. If you're using Expo, you can enable it using ",(0,i.jsx)(t.a,{href:"https://docs.expo.dev/versions/latest/sdk/build-properties/",children:(0,i.jsx)(t.code,{children:"expo-build-properties"})}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n  "expo": {\n    // ...\n    "plugins": [\n      // ...\n      // highlight-start\n      [\n        "expo-build-properties",\n        {\n          "android": {\n            "reactNativeReleaseLevel": "experimental"\n          },\n          "ios": {\n            "reactNativeReleaseLevel": "experimental"\n          }\n        }\n      ]\n      // highlight-end\n    ]\n  }\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["It will add the following lines in ",(0,i.jsx)(t.code,{children:"gradle.properties"})," (Android) and ",(0,i.jsx)(t.code,{children:"Info.plist"})," (iOS):"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-gradle",children:"reactNativeReleaseLevel=experimental\n"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"<key>ReactNativeReleaseLevel</key>\n<string>experimental</string>\n"})}),"\n",(0,i.jsxs)(t.p,{children:["If you're not using Expo, in order to enable experimental release level on Android, you need to add the following lines in ",(0,i.jsx)(t.code,{children:"MainApplication.kt"})," of your app:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-kt",children:"package com.helloworld\n\nimport android.app.Application\nimport com.facebook.react.PackageList\nimport com.facebook.react.ReactApplication\nimport com.facebook.react.ReactHost\nimport com.facebook.react.ReactNativeApplicationEntryPoint.loadReactNative\nimport com.facebook.react.ReactNativeHost\nimport com.facebook.react.ReactPackage\n// highlight-next-line\nimport com.facebook.react.defaults.DefaultNewArchitectureEntryPoint\nimport com.facebook.react.defaults.DefaultReactHost.getDefaultReactHost\nimport com.facebook.react.defaults.DefaultReactNativeHost\n// highlight-next-line\nimport com.facebook.react.common.ReleaseLevel\n\nclass MainApplication : Application(), ReactApplication {\n  // ...\n\n  override fun onCreate() {\n    super.onCreate()\n    // highlight-next-line\n    DefaultNewArchitectureEntryPoint.releaseLevel = ReleaseLevel.EXPERIMENTAL\n    loadReactNative(this)\n  }\n}\n"})}),"\n",(0,i.jsxs)(t.p,{children:["For iOS, you need edit the following line in ",(0,i.jsx)(t.code,{children:"AppDelegate.swift"})," of your app:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-swift",children:"@main\nclass AppDelegate: UIResponder, UIApplicationDelegate {\n  // ...\n\n  func application(\n    _ application: UIApplication,\n    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]? = nil\n  ) -> Bool {\n    let delegate = ReactNativeDelegate()\n    // highlight-next-line\n    let factory = RCTReactNativeFactory(delegate: delegate, releaseLevel: RCTReleaseLevel.Experimental)\n    delegate.dependencyProvider = RCTAppDependencyProvider()\n\n    // ...\n  }\n}\n"})}),"\n",(0,i.jsx)(t.h3,{id:"android_synchronously_update_ui_props",children:(0,i.jsx)(t.code,{children:"ANDROID_SYNCHRONOUSLY_UPDATE_UI_PROPS"})}),"\n",(0,i.jsxs)(t.p,{children:["When enabled, non-layout styles will be applied using the ",(0,i.jsx)(t.code,{children:"synchronouslyUpdateViewOnUIThread"})," method (which doesn't involve layout recalculation) instead of than ",(0,i.jsx)(t.code,{children:"ShadowTree::commit"})," method (which requires layout recalculation). In an artifical benchmark, it can lead to up to 4x increase of frames per second. Even though we don't expect such high speedups in the production apps, there should be a visible improvements in the smoothness of some animations. However, there are some unwanted side effects that one needs to take into account and properly compensate for:"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["The changes applied via ",(0,i.jsx)(t.code,{children:"synchronouslyUpdateViewOnUIThread"})," are not respected by the touch gesture system of Fabric renderer which can lead to incorrect behavior, in particular if transforms are applied. In that case, it's advisable to use ",(0,i.jsx)(t.code,{children:"Pressable"})," component from ",(0,i.jsx)(t.code,{children:"react-native-gesture-handler"})," (which attaches to the underlying platform view rather than using ",(0,i.jsx)(t.code,{children:"ShadowTree"})," to determine the component present at given point) rather than its original counterpart from ",(0,i.jsx)(t.code,{children:"react-native"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["The changes are applied via ",(0,i.jsx)(t.code,{children:"synchronouslyUpdateViewOnUIThread"})," are not synchronized with changes applied by ",(0,i.jsx)(t.code,{children:"ShadowTree::commit"})," which may lead to minor inconsistencies of animated styles or animated components in a single animation frame."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Currently, only the following styles can be updated using the fast path: ",(0,i.jsx)(t.code,{children:"opacity"}),", ",(0,i.jsx)(t.code,{children:"elevation"}),", ",(0,i.jsx)(t.code,{children:"zIndex"}),", ",(0,i.jsx)(t.code,{children:"backgroundColor"}),", ",(0,i.jsx)(t.code,{children:"tintColor"}),", ",(0,i.jsx)(t.code,{children:"borderRadius"})," (all sides), ",(0,i.jsx)(t.code,{children:"borderColor"})," (all sides) and ",(0,i.jsx)(t.code,{children:"transform"})," (all transforms). All remaining styles, if present, will be updated via ",(0,i.jsx)(t.code,{children:"ShadowTree::commit"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["This feature flag works only on Android and has no effect on iOS. For more details, see ",(0,i.jsx)(t.a,{href:"https://github.com/software-mansion/react-native-reanimated/pull/7823",children:"PR #7823"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"experimental_css_animations_for_svg_components",children:(0,i.jsx)(t.code,{children:"EXPERIMENTAL_CSS_ANIMATIONS_FOR_SVG_COMPONENTS"})}),"\n",(0,i.jsxs)(t.p,{children:["When enabled, CSS animations and transitions will also work for a limited set of props of several components from ",(0,i.jsx)(t.a,{href:"https://github.com/software-mansion/react-native-svg",children:(0,i.jsx)(t.code,{children:"react-native-svg"})})," library. Currently, ",(0,i.jsx)(t.code,{children:"Circle"}),", ",(0,i.jsx)(t.code,{children:"Ellipse"}),", ",(0,i.jsx)(t.code,{children:"Line"}),", ",(0,i.jsx)(t.code,{children:"Path"})," and ",(0,i.jsx)(t.code,{children:"Rect"})," components are supported."]}),"\n",(0,i.jsx)(t.h3,{id:"use_synchronizable_for_mutables",children:(0,i.jsx)(t.code,{children:"USE_SYNCHRONIZABLE_FOR_MUTABLES"})}),"\n",(0,i.jsxs)(t.p,{children:["This feature flag is supposed to speedup shared value reads on the RN runtime by reducing the number of calls to ",(0,i.jsx)(t.code,{children:"executeOnUIRuntimeSync"}),". When enabled, mutables (which are the primitives behind shared values) use ",(0,i.jsx)(t.code,{children:"Synchronizable"})," state to check if they should sync with the UI Runtime. For more details, see ",(0,i.jsx)(t.a,{href:"https://github.com/software-mansion/react-native-reanimated/pull/8080",children:"PR #8080"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"static-feature-flags",children:"Static feature flags"}),"\n",(0,i.jsx)(t.p,{children:"Static flags are intended to be resolved during code compilation and cannot be changed during application runtime. To enable a static feature flag, you need to:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["Add the following lines to ",(0,i.jsx)(t.code,{children:"package.json"})," of your app"]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n  // ...\n  "reanimated": {\n    "staticFeatureFlags": {\n      "EXAMPLE_STATIC_FLAG": true\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(t.ol,{start:"2",children:["\n",(0,i.jsxs)(t.li,{children:["Run ",(0,i.jsx)(t.code,{children:"pod install"})," (iOS only)"]}),"\n",(0,i.jsx)(t.li,{children:"Rebuild the native app"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["To read a static feature flag value in JavaScript, you can use ",(0,i.jsx)(t.code,{children:"getStaticFeatureFlag"})," function."]}),"\n",(0,i.jsx)(t.h2,{id:"dynamic-feature-flags",children:"Dynamic feature flags"}),"\n",(0,i.jsxs)(t.p,{children:["Dynamic flags can be modified during runtime and their values can change at any moment of app lifetime. To enable or disable a dynamic feature flag, you need to call ",(0,i.jsx)(t.code,{children:"setDynamicFeatureFlag"})," function."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-tsx",children:"import { setDynamicFeatureFlag } from 'react-native-reanimated';\n\nsetDynamicFeatureFlag('EXAMPLE_DYNAMIC_FLAG', true);\n"})}),"\n",(0,i.jsx)(t.h2,{id:"comparison-of-static-and-dynamic-feature-flags",children:"Comparison of static and dynamic feature flags"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Static feature flags"}),(0,i.jsx)(t.th,{style:{textAlign:"center"},children:"Dynamic feature flags"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Value is known during app build"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Value may change during app lifetime"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Value change requires app rebuild"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:"Can be changed via public JavaScript API"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsxs)(t.td,{children:["Can be changed via app's ",(0,i.jsx)(t.code,{children:"package.json"})]}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u2705"}),(0,i.jsx)(t.td,{style:{textAlign:"center"},children:"\u274c"})]})]})]}),"\n",(0,i.jsx)(t.h2,{id:"remarks-for-contributors",children:"Remarks for contributors"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Feature flags should switch the implementation to the new experimental behavior only when enabled."}),"\n",(0,i.jsx)(t.li,{children:"Initially, the default value should be false, allowing users to opt-in for the experimental behavior when desired."}),"\n",(0,i.jsx)(t.li,{children:"When the experimental behavior is considered stable, the default value should be set to true, while still allowing users to opt-out if needed."}),"\n",(0,i.jsx)(t.li,{children:"After some period, the feature flag which is enabled by default should be removed from the codebase."}),"\n",(0,i.jsxs)(t.li,{children:["Both static and dynamic feature flags should follow upper snake case, i.e. ",(0,i.jsx)(t.code,{children:"EXAMPLE_FEATURE_FLAG"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["The name of the feature flag should not contain the expression ",(0,i.jsx)(t.code,{children:"FEATURE_FLAG"})," itself."]}),"\n",(0,i.jsxs)(t.li,{children:["It is recommended to explicitly use ",(0,i.jsx)(t.code,{children:"ENABLE_"})," or ",(0,i.jsx)(t.code,{children:"DISABLE_"})," prefix for feature flags that enable or disable certain parts of the code for the sake of clarity."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);