"use strict";(self.webpackChunkdocs_reanimated=self.webpackChunkdocs_reanimated||[]).push([[9934],{59199:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>d,default:()=>v,frontMatter:()=>u,metadata:()=>a,toc:()=>m});const a=JSON.parse('{"id":"advanced/useFrameCallback","title":"useFrameCallback","description":"useFrameCallback lets you run a function on every frame update.","source":"@site/versioned_docs/version-3.x/advanced/useFrameCallback.mdx","sourceDirName":"advanced","slug":"/advanced/useFrameCallback","permalink":"/react-native-reanimated/docs/advanced/useFrameCallback","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-reanimated/edit/main/packages/docs-reanimated/versioned_docs/version-3.x/advanced/useFrameCallback.mdx","tags":[],"version":"3.x","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"useAnimatedReaction","permalink":"/react-native-reanimated/docs/advanced/useAnimatedReaction"},"next":{"title":"useEvent","permalink":"/react-native-reanimated/docs/advanced/useEvent"}}');var i=t(74848),s=t(28453),l=t(98545),r=t(88920),o=t(72503),c=t(72110);const u={sidebar_position:3},d="useFrameCallback",h={},m=[{value:"Reference",id:"reference",level:2},{value:"Arguments",id:"arguments",level:3},{value:"<code>callback</code>",id:"callback",level:4},{value:"<code>autostart</code> <Optional></Optional>",id:"autostart-",level:4},{value:"Returns",id:"returns",level:3},{value:"Example",id:"example",level:2},{value:"Remarks",id:"remarks",level:2},{value:"Platform compatibility",id:"platform-compatibility",level:2}];function b(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Details:t,InteractiveExample:a,Optional:u,PlatformCompatibility:d}=n;return t||f("Details",!0),a||f("InteractiveExample",!0),u||f("Optional",!0),d||f("PlatformCompatibility",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"useframecallback",children:"useFrameCallback"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"useFrameCallback"})," lets you run a function on every frame update."]}),"\n","\n",(0,i.jsx)(a,{src:r.A,component:l.A}),"\n",(0,i.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"import { useFrameCallback } from 'react-native-reanimated';\n\nfunction App() {\n  const frameCallback = useFrameCallback((frameInfo) => {\n    // Increment a value on every frame update\n    sv.value += 1;\n  });\n\n  return (\n    <Button\n      title=\"Start/Stop\"\n      onPress={() => frameCallback.setActive(!frameCallback.isActive)}\n    />\n  );\n}\n"})}),"\n",(0,i.jsxs)(t,{children:[(0,i.jsx)("summary",{children:"Type definitions"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"type FrameInfo = {\n  timestamp: number;\n  timeSincePreviousFrame: number | null;\n  timeSinceFirstFrame: number;\n};\n\ntype FrameCallback = {\n  setActive: (isActive: boolean) => void;\n  isActive: boolean;\n  callbackId: number;\n};\n\nfunction useFrameCallback(\n  callback: (frameInfo: FrameInfo) => void,\n  autostart = true\n): FrameCallback;\n"})})]}),"\n",(0,i.jsx)(n.h3,{id:"arguments",children:"Arguments"}),"\n",(0,i.jsx)(n.h4,{id:"callback",children:(0,i.jsx)(n.code,{children:"callback"})}),"\n",(0,i.jsxs)(n.p,{children:["A function executed on every frame update. This function receives a ",(0,i.jsx)(n.code,{children:"frameInfo"})," object containing the following fields:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"timestamp"})," a number indicating the system time (in milliseconds) when the last frame was rendered."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"timeSincePreviousFrame"})," a number indicating the time (in milliseconds) since last frame. This value will be null on the first frame after activation. Starting from the second frame, it should be ~16 ms on 60 Hz, and ~8 ms on 120 Hz displays (provided there are no frame dropped)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"timeSinceFirstFrame"})," a number indicating the time (in milliseconds) since the callback was activated."]}),"\n"]}),"\n",(0,i.jsxs)(n.h4,{id:"autostart-",children:[(0,i.jsx)(n.code,{children:"autostart"})," ",(0,i.jsx)(u,{})]}),"\n",(0,i.jsxs)(n.p,{children:["Whether the callback should start automatically. Defaults to ",(0,i.jsx)(n.code,{children:"true"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"returns",children:"Returns"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"useFrameCallback"})," returns an object containing these fields:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"setActive"})," a function that lets you start the frame callback or stop it from running"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"isActive"})," a boolean indicating whether a callback is running"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"callbackId"})," a number indicating a unique identifier of the frame callback"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n","\n",(0,i.jsx)(a,{src:c.A,component:o.A,label:"Tap to jump"}),"\n",(0,i.jsx)(n.h2,{id:"remarks",children:"Remarks"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["A function passed to the ",(0,i.jsx)(n.code,{children:"callback"})," argument is automatically ",(0,i.jsx)(n.a,{href:"/docs/fundamentals/glossary#to-workletize",children:"workletized"})," and ran on the ",(0,i.jsx)(n.a,{href:"/docs/fundamentals/glossary#ui-thread",children:"UI thread"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"platform-compatibility",children:"Platform compatibility"}),"\n",(0,i.jsx)(d,{android:!0,ios:!0,web:!0})]})}function v(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(b,{...e})}):b(e)}function f(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},72110:(e,n,t)=>{t.d(n,{A:()=>a});const a="import Animated, {\n  useSharedValue,\n  useFrameCallback,\n  useAnimatedStyle,\n  withSequence,\n  withTiming,\n  Easing,\n  FrameInfo,\n} from 'react-native-reanimated';\nimport {\n  View,\n  StyleSheet,\n  Pressable,\n  Text,\n  LayoutChangeEvent,\n} from 'react-native';\nimport React from 'react';\n\ninterface CollisionObject {\n  height: number;\n  width: number;\n  x: number;\n  y: number;\n}\n\nconst HEIGHT = 200;\nconst DEFAULT_VELOCITY = 0.6;\nconst VELOCITY_INCREMENT = 0.00005;\nconst GROUND_LEVEL = 80;\nconst DEFAULT_Y = HEIGHT - GROUND_LEVEL - 80;\nconst DEFAULT_X = 1000;\n\nconst DEFAULT_OBSTACLE = {\n  height: 85,\n  width: 82,\n  x: 0,\n  y: DEFAULT_Y,\n};\nconst DEFAULT_HORSE = {\n  height: 85,\n  width: 82,\n  x: 0,\n  y: DEFAULT_Y,\n};\n\nexport default function FrameCallbackDino() {\n  const vx = useSharedValue<number>(DEFAULT_VELOCITY);\n  const width = useSharedValue<number>(0);\n\n  const obstacleX = useSharedValue<number>(DEFAULT_X);\n  const horseY = useSharedValue<number>(DEFAULT_Y);\n\n  const gameOver = useSharedValue<boolean>(false);\n\n  const getDimensions = (event: LayoutChangeEvent) => {\n    width.value = event.nativeEvent.layout.width;\n  };\n\n  // highlight-next-line\n  useFrameCallback((frameInfo: FrameInfo) => {\n    const { timeSincePreviousFrame: dt } = frameInfo;\n    if (dt == null) {\n      return;\n    }\n\n    const horse: CollisionObject = { ...DEFAULT_HORSE, y: horseY.value };\n    const obstacle: CollisionObject = {\n      ...DEFAULT_OBSTACLE,\n      x: obstacleX.value,\n    };\n\n    if (isColliding(horse, obstacle) || gameOver.value) {\n      gameOver.value = true;\n      return;\n    }\n\n    obstacleX.value =\n      obstacleX.value > -100 ? obstacleX.value - vx.value * dt : width.value;\n\n    vx.value += VELOCITY_INCREMENT;\n    // highlight-next-line\n  });\n\n  const obstacleStyles = useAnimatedStyle(() => ({\n    transform: [\n      { translateX: obstacleX.value },\n      { translateY: DEFAULT_OBSTACLE.y },\n    ],\n  }));\n\n  const horseStyles = useAnimatedStyle(() => ({\n    transform: [\n      { translateX: DEFAULT_HORSE.x },\n      { translateY: horseY.value },\n      { rotateY: '180deg' },\n    ],\n  }));\n\n  const overlayStyles = useAnimatedStyle(() => ({\n    transform: [{ translateY: gameOver.value === true ? 0 : -1000 }],\n  }));\n\n  const handleTap = () => {\n    if (gameOver.value) {\n      handleRestart();\n    } else {\n      handleJump();\n    }\n  };\n\n  const handleJump = () => {\n    if (horseY.value === DEFAULT_Y) {\n      horseY.value = withSequence(\n        withTiming(DEFAULT_Y - 120, {\n          easing: Easing.bezier(0.3, 0.11, 0.15, 0.97),\n        }),\n        withTiming(DEFAULT_Y, { easing: Easing.poly(4) })\n      );\n    }\n  };\n\n  const handleRestart = () => {\n    gameOver.value = false;\n    obstacleX.value = DEFAULT_X;\n    horseY.value = DEFAULT_Y;\n    vx.value = DEFAULT_VELOCITY;\n  };\n\n  return (\n    <>\n      <Pressable\n        style={styles.container}\n        onLayout={getDimensions}\n        onPressIn={handleTap}>\n        <Animated.View style={[styles.overlay, overlayStyles]}>\n          <Text style={styles.text}>Game Over</Text>\n        </Animated.View>\n        <Animated.Text style={[styles.obstacle, obstacleStyles]}>\n          \ud83c\udf35\n        </Animated.Text>\n        <Animated.Text style={[styles.horse, horseStyles]}>\ud83d\udc0e</Animated.Text>\n        <View style={styles.ground} />\n      </Pressable>\n    </>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    height: 200,\n  },\n  horse: {\n    position: 'absolute',\n    fontSize: 80,\n  },\n  ground: {\n    position: 'absolute',\n    right: 0,\n    bottom: GROUND_LEVEL - 10,\n    width: '100%',\n    height: 2,\n    backgroundColor: '#000',\n  },\n  obstacle: {\n    position: 'absolute',\n    fontSize: 80,\n  },\n  text: {\n    fontSize: 40,\n    color: 'white',\n    backgroundColor: 'rgba(0,0,0,0.5)',\n    paddingHorizontal: 8,\n  },\n  overlay: {\n    justifyContent: 'center',\n    alignItems: 'center',\n    position: 'absolute',\n    width: '100%',\n    zIndex: 1,\n  },\n});\n\nfunction isColliding(obj1: CollisionObject, obj2: CollisionObject) {\n  'worklet';\n  return (\n    obj1.x < obj2.x + obj2.width &&\n    obj1.x + obj1.width > obj2.x &&\n    obj1.y < obj2.y + obj2.height &&\n    obj1.y + obj1.height > obj2.y\n  );\n}\n"},72503:(e,n,t)=>{t.d(n,{A:()=>g});var a=t(55535),i=t(70690),s=t(78506),l=t(9176),r=t(72188),o=t(74848);const c=.6,u=5e-5,d=40,h=1e3,m={height:85,width:82,x:0,y:d},b={height:85,width:82,x:0,y:d},v={code:"function FrameCallbackDinoTsx1(frameInfo){const{DEFAULT_HORSE,horseY,DEFAULT_OBSTACLE,obstacleX,isColliding,gameOver,vx,width,VELOCITY_INCREMENT}=this.__closure;const{timeSincePreviousFrame:dt}=frameInfo;if(dt==null){return;}const horse={...DEFAULT_HORSE,y:horseY.value};const obstacle={...DEFAULT_OBSTACLE,x:obstacleX.value};if(isColliding(horse,obstacle)||gameOver.value){gameOver.value=true;return;}obstacleX.value=obstacleX.value>-100?obstacleX.value-vx.value*dt:width.value;vx.value+=VELOCITY_INCREMENT;}"},f={code:"function FrameCallbackDinoTsx2(){const{obstacleX,DEFAULT_OBSTACLE}=this.__closure;return{transform:[{translateX:obstacleX.value},{translateY:DEFAULT_OBSTACLE.y}]};}"},x={code:"function FrameCallbackDinoTsx3(){const{DEFAULT_HORSE,horseY}=this.__closure;return{transform:[{translateX:DEFAULT_HORSE.x},{translateY:horseY.value},{rotateY:'180deg'}]};}"},y={code:"function FrameCallbackDinoTsx4(){const{gameOver}=this.__closure;return{transform:[{translateY:gameOver.value===true?0:-1000}]};}"};function g(){const e=(0,a.useSharedValue)(c),n=(0,a.useSharedValue)(0),t=(0,a.useSharedValue)(h),r=(0,a.useSharedValue)(d),g=(0,a.useSharedValue)(!1);(0,a.useFrameCallback)(function(){const a=function(a){const{timeSincePreviousFrame:i}=a;if(null==i)return;const s={...b,y:r.value},l={...m,x:t.value};_(s,l)||g.value?g.value=!0:(t.value=t.value>-100?t.value-e.value*i:n.value,e.value+=u)};return a.__closure={DEFAULT_HORSE:b,horseY:r,DEFAULT_OBSTACLE:m,obstacleX:t,isColliding:_,gameOver:g,vx:e,width:n,VELOCITY_INCREMENT:u},a.__workletHash=3185936793975,a.__initData=v,a}());const j=(0,a.useAnimatedStyle)(function(){const e=()=>({transform:[{translateX:t.value},{translateY:m.y}]});return e.__closure={obstacleX:t,DEFAULT_OBSTACLE:m},e.__workletHash=598128048319,e.__initData=f,e}()),E=(0,a.useAnimatedStyle)(function(){const e=()=>({transform:[{translateX:b.x},{translateY:r.value},{rotateY:"180deg"}]});return e.__closure={DEFAULT_HORSE:b,horseY:r},e.__workletHash=7481394469968,e.__initData=x,e}()),A=(0,a.useAnimatedStyle)(function(){const e=()=>({transform:[{translateY:!0===g.value?0:-1e3}]});return e.__closure={gameOver:g},e.__workletHash=0xf0c9f5032be,e.__initData=y,e}()),S=()=>{r.value===d&&(r.value=(0,a.withSequence)((0,a.withTiming)(d-120,{easing:a.Easing.bezier(.3,.11,.15,.97)}),(0,a.withTiming)(d,{easing:a.Easing.poly(4)})))},T=()=>{g.value=!1,t.value=h,r.value=d,e.value=c};return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(i.A,{style:p.container,onLayout:e=>{n.value=e.nativeEvent.layout.width},onPressIn:()=>{g.value?T():S()},children:[(0,o.jsx)(a.default.View,{style:[p.overlay,A],children:(0,o.jsx)(s.A,{style:p.text,children:"Game Over"})}),(0,o.jsx)(a.default.Text,{style:[p.obstacle,j],children:"\ud83c\udf35"}),(0,o.jsx)(a.default.Text,{style:[p.horse,E],children:"\ud83d\udc0e"}),(0,o.jsx)(l.A,{style:p.ground})]})})}const p=r.A.create({container:{flex:1,height:200},horse:{position:"absolute",fontSize:80},ground:{position:"absolute",right:0,bottom:70,width:"100%",height:2,backgroundColor:"#000"},obstacle:{position:"absolute",fontSize:80},text:{fontSize:40,color:"white",backgroundColor:"rgba(0,0,0,0.5)",paddingHorizontal:8},overlay:{justifyContent:"center",alignItems:"center",position:"absolute",width:"100%",zIndex:1}}),j={code:"function isColliding_FrameCallbackDinoTsx5(obj1,obj2){return obj1.x<obj2.x+obj2.width&&obj1.x+obj1.width>obj2.x&&obj1.y<obj2.y+obj2.height&&obj1.y+obj1.height>obj2.y;}"},_=function(){const e=function(e,n){return e.x<n.x+n.width&&e.x+e.width>n.x&&e.y<n.y+n.height&&e.y+e.height>n.y};return e.__closure={},e.__workletHash=9316259044170,e.__initData=j,e}()},88920:(e,n,t)=>{t.d(n,{A:()=>a});const a="import React from 'react';\nimport { StyleSheet, View } from 'react-native';\nimport Animated, {\n  useFrameCallback,\n  useSharedValue,\n  useAnimatedStyle,\n} from 'react-native-reanimated';\n\ninterface AppProps {\n  width: number;\n}\n\nexport default function App({ width }: AppProps) {\n  const t = useSharedValue<number>(0);\n\n  // highlight-start\n  useFrameCallback((frameInfo) => {\n    t.value = frameInfo.timeSinceFirstFrame / 350;\n  });\n  // highlight-end\n\n  const infinityStyle = useAnimatedStyle(() => {\n    const scale = 2 / (3 - Math.cos(2 * t.value));\n    return {\n      transform: [\n        {\n          translateX:\n            scale * Math.cos(t.value) * Math.min(width / 2 - 120, 200),\n        },\n        { translateY: scale * (Math.sin(2 * t.value) / 2) * 200 },\n      ],\n    };\n  });\n\n  return (\n    <View style={styles.container}>\n      <Animated.View style={[styles.dot, infinityStyle]} />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: 150,\n  },\n  dot: {\n    width: 60,\n    height: 60,\n    borderRadius: 30,\n    backgroundColor: '#b58df1',\n    position: 'absolute',\n  },\n});\n"},98545:(e,n,t)=>{t.d(n,{A:()=>c});var a=t(9176),i=t(72188),s=t(55535),l=t(74848);const r={code:"function FrameCallbackSimpleTsx1(frameInfo){const{t}=this.__closure;t.value=frameInfo.timeSinceFirstFrame/350;}"},o={code:"function FrameCallbackSimpleTsx2(){const{t,width}=this.__closure;const scale=2/(3-Math.cos(2*t.value));return{transform:[{translateX:scale*Math.cos(t.value)*Math.min(width/2-120,200)},{translateY:scale*(Math.sin(2*t.value)/2)*200}]};}"};function c(e){let{width:n}=e;const t=(0,s.useSharedValue)(0);(0,s.useFrameCallback)(function(){const e=function(e){t.value=e.timeSinceFirstFrame/350};return e.__closure={t:t},e.__workletHash=0x9b55df9bcbe,e.__initData=r,e}());const i=(0,s.useAnimatedStyle)(function(){const e=function(){const e=2/(3-Math.cos(2*t.value));return{transform:[{translateX:e*Math.cos(t.value)*Math.min(n/2-120,200)},{translateY:e*(Math.sin(2*t.value)/2)*200}]}};return e.__closure={t:t,width:n},e.__workletHash=7084236251646,e.__initData=o,e}());return(0,l.jsx)(a.A,{style:u.container,children:(0,l.jsx)(s.default.View,{style:[u.dot,i]})})}const u=i.A.create({container:{flex:1,alignItems:"center",justifyContent:"center",height:150},dot:{width:60,height:60,borderRadius:30,backgroundColor:"#b58df1",position:"absolute"}})}}]);