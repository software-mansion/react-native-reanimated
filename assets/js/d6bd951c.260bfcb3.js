"use strict";(self.webpackChunkdocs_reanimated=self.webpackChunkdocs_reanimated||[]).push([[2225],{30620:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>o});var r=n(39471);const i={},a=r.createContext(i);function s(e){const t=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(a.Provider,{value:t},e.children)}},39590:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"threading/createWorkletRuntime","title":"createWorkletRuntime","description":"createWorkletRuntime lets you create a new JS runtime which can be used to run worklets possibly on different threads than JS or UI thread. This function is supposed to be used by third-party libraries that need to integrate with worklets. The return value represents the runtime and it\'s supposed to be passed to C++ side using JSI (JavaScript Interface) for further operations.","source":"@site/versioned_docs/version-3.x/threading/createWorkletRuntime.mdx","sourceDirName":"threading","slug":"/threading/createWorkletRuntime","permalink":"/react-native-reanimated/docs/3.x/threading/createWorkletRuntime","draft":false,"unlisted":false,"editUrl":"https://github.com/software-mansion/react-native-reanimated/edit/main/packages/docs-reanimated/versioned_docs/version-3.x/threading/createWorkletRuntime.mdx","tags":[],"version":"3.x","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"runOnRuntime","permalink":"/react-native-reanimated/docs/3.x/threading/runOnRuntime"},"next":{"title":"Utilities","permalink":"/react-native-reanimated/docs/3.x/category/utilities"}}');var i=n(47671),a=n(30620);const s={sidebar_position:4},o="createWorkletRuntime",l={},d=[{value:"Reference",id:"reference",level:2},{value:"Usage in JavaScript",id:"usage-in-javascript",level:3},{value:"Usage in C++",id:"usage-in-c",level:3},{value:"Arguments",id:"arguments",level:3},{value:"<code>name</code>",id:"name",level:4},{value:"<code>initializer</code>",id:"initializer",level:4},{value:"Returns",id:"returns",level:3},{value:"Remarks",id:"remarks",level:2},{value:"Platform compatibility",id:"platform-compatibility",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components},{Details:n,PlatformCompatibility:r}=t;return n||h("Details",!0),r||h("PlatformCompatibility",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"createworkletruntime",children:"createWorkletRuntime"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"createWorkletRuntime"})," lets you create a new JS runtime which can be used to run ",(0,i.jsx)(t.a,{href:"/docs/fundamentals/glossary#worklet",children:"worklets"})," possibly on different threads than ",(0,i.jsx)(t.a,{href:"/docs/fundamentals/glossary#javascript-thread",children:"JS"})," or ",(0,i.jsx)(t.a,{href:"/docs/fundamentals/glossary#ui-thread",children:"UI thread"}),". This function is supposed to be used by third-party libraries that need to integrate with worklets. The return value represents the runtime and it's supposed to be passed to C++ side using JSI (JavaScript Interface) for further operations."]}),"\n",(0,i.jsx)(t.h2,{id:"reference",children:"Reference"}),"\n",(0,i.jsx)(t.h3,{id:"usage-in-javascript",children:"Usage in JavaScript"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-jsx",children:"import { createWorkletRuntime } from 'react-native-reanimated';\n\nfunction App() {\n  const runtime = createWorkletRuntime('background');\n}\n"})}),"\n",(0,i.jsx)(t.h3,{id:"usage-in-c",children:"Usage in C++"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-cpp",children:"auto runtime = reanimated::extractWorkletRuntime(rt, runtimeValue);\n\njsi::Runtime &rt = runtime->getJSIRuntime();\n\nauto worklet = reanimated::extractShareableOrThrow<reanimated::ShareableWorklet>(rt, workletValue);\n\nruntime->runGuarded(worklet, ...args);\n"})}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:"Type definitions"}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"type WorkletRuntime = {\n  __hostObjectWorkletRuntime: never;\n  readonly name: string;\n};\n\nfunction createWorkletRuntime(\n  name: string,\n  initializer?: __ComplexWorkletFunction<[], void>\n): WorkletRuntime;\n"})})]}),"\n",(0,i.jsx)(t.h3,{id:"arguments",children:"Arguments"}),"\n",(0,i.jsx)(t.h4,{id:"name",children:(0,i.jsx)(t.code,{children:"name"})}),"\n",(0,i.jsx)(t.p,{children:"A name used to identify the runtime which will appear in devices list in Chrome DevTools."}),"\n",(0,i.jsx)(t.h4,{id:"initializer",children:(0,i.jsx)(t.code,{children:"initializer"})}),"\n",(0,i.jsx)(t.p,{children:"An optional worklet that will be run synchronously on the same thread immediately after the runtime is created. It can be used to inject some global variables or functions into the runtime."}),"\n",(0,i.jsx)(t.h3,{id:"returns",children:"Returns"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"createWorkletRuntime"})," returns ",(0,i.jsx)(t.code,{children:"WorkletRuntime"})," which is a ",(0,i.jsx)(t.code,{children:"jsi::HostObject<reanimated::WorkletRuntime>"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"remarks",children:"Remarks"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Worklet runtimes come with ",(0,i.jsx)(t.code,{children:"performance.now"})," and ",(0,i.jsx)(t.code,{children:"console.*"})," methods installed out-of-the-box. Other APIs are not available and need to be injected into the runtime or captured via worklet closure."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["In development mode, all unhandled errors thrown in the runtime (except for those thrown in ",(0,i.jsx)(t.code,{children:"initializer"}),") will be caught and thus logged to the console and displayed in a LogBox."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["You can use Chrome DevTools to debug the runtime (Hermes only). The runtime will appear in the devices list as ",(0,i.jsx)(t.code,{children:"name"})," passed to ",(0,i.jsx)(t.code,{children:"createWorkletRuntime"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.a,{href:"/docs/fundamentals/glossary#shared-value",children:"Shared values"})," are only partially supported in worklet runtimes. If you want to write to a shared value from the RN runtime and read it on the worklet runtime, you need to perform the assignment using ",(0,i.jsx)(t.a,{href:"https://docs.swmansion.com/react-native-worklets/docs/threading/runOnRuntime",children:(0,i.jsx)(t.code,{children:"runOnRuntime"})}),". Otherwise, the value will be updated only in the RN and UI runtimes."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"platform-compatibility",children:"Platform compatibility"}),"\n",(0,i.jsx)(r,{android:!0,ios:!0})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}function h(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);