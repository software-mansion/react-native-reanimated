"use strict";(self.webpackChunkreact_native_reanimated=self.webpackChunkreact_native_reanimated||[]).push([[7062],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),m=i,g=c["".concat(s,".").concat(m)]||c[m]||u[m]||r;return n?a.createElement(g,o(o({ref:t},d),{},{components:n})):a.createElement(g,o({ref:t},d))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},4403:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return o},default:function(){return u},frontMatter:function(){return r},metadata:function(){return l},toc:function(){return p}});var a=n(3117),i=(n(7294),n(3905));const r={id:"installation",title:"Installation",sidebar_label:"Installation"},o=void 0,l={unversionedId:"installation",id:"version-2.2.x/installation",title:"Installation",description:"Reanimated 2 is primarily built in C++ using Turbo Modules infrastructure which is not yet completely deployed in React Native (specifically on Android).",source:"@site/versioned_docs/version-2.2.x/installation.md",sourceDirName:".",slug:"/installation",permalink:"/react-native-reanimated/docs/2.2.x/installation",draft:!1,tags:[],version:"2.2.x",frontMatter:{id:"installation",title:"Installation",sidebar_label:"Installation"},sidebar:"version-2.2.x/docs",previous:{title:"About",permalink:"/react-native-reanimated/docs/2.2.x/"},next:{title:"Worklets",permalink:"/react-native-reanimated/docs/2.2.x/worklets"}},s={},p=[{value:"I just want to try new Reanimated...",id:"i-just-want-to-try-new-reanimated",level:2},{value:"Installing the package",id:"installing-the-package",level:2},{value:"Reanimated 2 in Expo",id:"reanimated-2-in-expo",level:3},{value:"Using main branch builds",id:"using-main-branch-builds",level:3},{value:"Babel plugin",id:"babel-plugin",level:2},{value:"Android",id:"android",level:2},{value:"Proguard",id:"proguard",level:3},{value:"iOS",id:"ios",level:2}],d={toc:p};function u(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Reanimated 2 is primarily built in C++ using ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/react-native-community/discussions-and-proposals/issues/40"},"Turbo Modules")," infrastructure which is not yet completely deployed in React Native (specifically on Android).\nBecause of that the installation of new Reanimated requires additional steps apart from just adding a dependency to ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," ."),(0,i.kt)("p",null,"As a consequence of the above the minimum supported version of React Native is ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/facebook/react-native/releases/tag/v0.62.0"},"v0.62"),".\nBefore you continue with the installation, make sure that you are running the supported version of React Native."),(0,i.kt)("p",null,"Please follow the below instructions for Android and iOS."),(0,i.kt)("h2",{id:"i-just-want-to-try-new-reanimated"},"I just want to try new Reanimated..."),(0,i.kt)("p",null,"We realize the project setup is very complex and you may not want to add that to your existing app rightaway.\nIf you just want to play with Reanimated 2, we made a clean repo that has all the steps configured so that you can pull it from github and give the new version a shot."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/software-mansion-labs/reanimated-2-playground"},"Visit the Playground repo here")," or copy the command below to do a git clone:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git clone git@github.com:software-mansion-labs/reanimated-2-playground.git\n")),(0,i.kt)("p",null,"Continue with the instruction below if you'd like to install Reanimated v2 on an existing or new React Native project."),(0,i.kt)("h2",{id:"installing-the-package"},"Installing the package"),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Please note that Reanimated 2 doesn't support remote debugging, only Flipper can be used for debugging.")),(0,i.kt)("p",null,"First step is to install ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native-reanimated")," alpha as a dependency in your project:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add react-native-reanimated\n")),(0,i.kt)("h3",{id:"reanimated-2-in-expo"},"Reanimated 2 in Expo"),(0,i.kt)("p",null,"To use experimental support of Reanimated 2 in the Expo managed apps follow ",(0,i.kt)("a",{parentName:"p",href:"https://docs.expo.io/versions/latest/sdk/reanimated/"},"their installation instructions"),"."),(0,i.kt)("h3",{id:"using-main-branch-builds"},"Using main branch builds"),(0,i.kt)("p",null,"To use Reanimated 2 built from the main branch:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"go to the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/software-mansion/react-native-reanimated/actions?query=workflow%3A%22Build+npm+package%22"},'"Build npm package" workflow in Reanimated repository')),(0,i.kt)("li",{parentName:"ul"},"select latest build and download ",(0,i.kt)("inlineCode",{parentName:"li"},"react-native-reanimated-2.0.0-alpha.tgz")," artifact"),(0,i.kt)("li",{parentName:"ul"},"run ",(0,i.kt)("inlineCode",{parentName:"li"},"tar zxvf react-native-reanimated-2.0.0-alpha.tgz.zip")," to unpack zip (or unpack it manually)"),(0,i.kt)("li",{parentName:"ul"},"run ",(0,i.kt)("inlineCode",{parentName:"li"},"yarn add file:react-native-reanimated-2.0.0-*.tgz")," to install the package"),(0,i.kt)("li",{parentName:"ul"},"run ",(0,i.kt)("inlineCode",{parentName:"li"},"cd android && ./gradlew clean"))),(0,i.kt)("h2",{id:"babel-plugin"},"Babel plugin"),(0,i.kt)("p",null,"Add Reanimated's Babel plugin to your ",(0,i.kt)("inlineCode",{parentName:"p"},"babel.config.js"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"{7}","{7}":!0},"  module.exports = {\n    presets: [\n      ...\n    ],\n    plugins: [\n      ...\n      'react-native-reanimated/plugin',\n    ],\n  };\n")),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Reanimated plugin has to be listed last.")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"After adding the ",(0,i.kt)("inlineCode",{parentName:"p"},"react-native-reanimated/plugin"),' to your project you may encounter a false-positive "Reanimated 2 failed to create a worklet" error. In most cases, this can be fixed by cleaning the application\'s cache. Depending on your workflow or favourite package manager that could be done by:'),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"yarn start --reset-cache")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"npm start -- --reset-cache")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"expo start -c"))),(0,i.kt)("p",{parentName:"admonition"},"or other.")),(0,i.kt)("h2",{id:"android"},"Android"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Turn on Hermes engine by editing ",(0,i.kt)("inlineCode",{parentName:"li"},"android/app/build.gradle"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java",metastring:"{2}","{2}":!0},"project.ext.react = [\n  enableHermes: true  // <- here | clean and rebuild if changing\n]\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Plug Reanimated in ",(0,i.kt)("inlineCode",{parentName:"li"},"MainApplication.java"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java",metastring:"{1-2,12-15}","{1-2,12-15}":!0},'  import com.facebook.react.bridge.JSIModulePackage; // <- add\n  import com.swmansion.reanimated.ReanimatedJSIModulePackage; // <- add\n  ...\n  private final ReactNativeHost mReactNativeHost = new ReactNativeHost(this) {\n  ...\n\n      @Override\n      protected String getJSMainModuleName() {\n        return "index";\n      }\n\n      @Override\n      protected JSIModulePackage getJSIModulePackage() {\n        return new ReanimatedJSIModulePackage(); // <- add\n      }\n    };\n  ...\n')),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"In previous releases, we required an additional step which is turning on Turbo Modules.\nIf you are upgrading from alpha.{ <=3 } please remove the following lines:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-Java"},"static {\n   ReactFeatureFlags.useTurboModules = true;\n }\n")),(0,i.kt)("p",{parentName:"admonition"},"from ",(0,i.kt)("inlineCode",{parentName:"p"},"MainActivity.java"),".")),(0,i.kt)("p",null,"You can refer ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/software-mansion-labs/reanimated-2-playground/pull/8/commits/71642dbe7bd96eb41df5b9f59d661ab15f6fc3f8"},"to this diff")," that presents the set of the above changes made to a fresh react native project in our ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/software-mansion-labs/reanimated-2-playground"},"Playground repo"),"."),(0,i.kt)("h3",{id:"proguard"},"Proguard"),(0,i.kt)("p",null,"If you're using Proguard, make sure to add rule preventing it from optimizing Turbomodule classes:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"-keep class com.facebook.react.turbomodule.** { *; }\n")),(0,i.kt)("h2",{id:"ios"},"iOS"),(0,i.kt)("p",null,"Run ",(0,i.kt)("inlineCode",{parentName:"p"},"pod install")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"ios/")," directory."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"In previous releases, the installation process was manual and required turning turbo modules on. Some libraries break when turbo modules are enabled so we decided to change our approach and we no longer\nuse the standard way for registering a turbo module. It let us simplify the installation process and as a result, you can safely\nundo all installation steps from the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/software-mansion/react-native-reanimated/blob/2.0.0-alpha.4/docs/docs/installation.md#ios"},"previous instruction"),".")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If you want to turn off autoinstall on iOS please add the following compilation flag:\n",(0,i.kt)("inlineCode",{parentName:"p"},"DONT_AUTOINSTALL_REANIMATED"),".\nIt can be done by pasting:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-js"},"post_install do |installer|\n   installer.pods_project.targets.each do |target|\n       target.build_configurations.each do |config|\n           config.build_settings['OTHER_CPLUSPLUSFLAGS'] = '-DDONT_AUTOINSTALL_REANIMATED'\n       end\n   end\nend\n")),(0,i.kt)("p",{parentName:"admonition"},"to your ",(0,i.kt)("inlineCode",{parentName:"p"},"Podfile"),". Don't forget to run ",(0,i.kt)("inlineCode",{parentName:"p"},"pod install")," after doing that.")))}u.isMDXComponent=!0}}]);